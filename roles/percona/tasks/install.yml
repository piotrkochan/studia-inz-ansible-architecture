---

- name: "Add Percona yum repository"
  yum:
    name: https://repo.percona.com/yum/percona-release-latest.noarch.rpm
    state: present
  when: install_rpm_repositories|bool

- name: Enable Percona repository (Percona version >= 8)
  command: "percona-release setup ps{{ percona__version_major }}{{ percona__version_minor }}"
  when: percona__version_major|int >= 8 and install_rpm_repositories|bool
  changed_when: false

- name: "Install percona database server"
  yum:
    name: Percona-XtraDB-Cluster-{{percona__version_major}}{{percona__version_minor}}
    state: present

- name: "Install MySQL-python package"
  yum:
    name: "MySQL-python"
    state: present

# - name: "Adjust permissions of datadir"
#   file:
#     path: "{{ percona__mysql_datadir }}"
#     owner: "mysql"
#     group: "mysql"
#     mode: 0755
#     state: "directory"
